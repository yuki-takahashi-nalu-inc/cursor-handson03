# 第5章: 【オプション】実践テクニックとトラブルシューティング

> **注意**: この章はオプションです。基本的な使い方をマスターした後、さらにCursorを活用したい場合に学習してください。

## 学習目標
- AIに効果的な指示を出すプロンプトの書き方を学ぶ
- AIペアプログラミングでよくあるトラブルと解決方法を理解
- チーム開発でAIと協働する方法を学ぶ

## 6.1 効果的なプロンプトの書き方

### プロンプトエンジニアリングの基本

#### 良いプロンプトの要素
1. **明確な目的**
2. **具体的な要件**
3. **期待する出力形式**
4. **制約条件**

### プロンプトの実例比較

#### ❌ 悪い例
```
フォームを作って
```

#### ✅ 良い例
```
shadcn/uiのForm、Input、Buttonコンポーネントを使用して、
カード追加フォームを作成してください。

要件：
- タイトル（必須、最大50文字）
- 説明（任意、最大200文字）
- 優先度選択（high/medium/low）
- バリデーションエラーの表示
- Enterキーで送信、Escapeでキャンセル

TypeScriptで型安全に実装してください。
```

### コンテキストの提供方法

#### @記法の活用
```
@src/types/kanban.ts @src/components/Card
これらのファイルの型定義とコンポーネント構造を参考に、
新しいカード編集機能を実装してください。
```

#### 段階的な指示
```
ステップ1: 基本的なフォームコンポーネントを作成
ステップ2: バリデーションを追加
ステップ3: キーボードショートカットを実装
ステップ4: アニメーションを追加
```

## 6.2 よくあるトラブルと解決法

### トラブル1: Tab補完が効かない

**症状：**
- Tabを押してもコード補完されない
- 提案が表示されない

**解決法：**
```
1. より詳細なコメントを書く
// Create a React component with TypeScript props interface

2. ファイルの拡張子を確認（.tsx, .ts）

3. プロジェクトのRules設定でコンテキストを明確に（Settings → Cursor Rules）

4. Settings → Features → Auto-completion を確認
```

### トラブル2: Agentが期待通りに動作しない

**症状：**
- ファイルが作成されない
- 部分的な更新しかされない

**解決法：**
```
1. Agentモードを選択しているか確認

2. より具体的な指示を出す
「src/components/NewComponent.tsxを作成して、以下の機能を実装」

3. 権限の問題がないか確認
「ターミナルでnpmコマンドの実行を許可」

4. エラーメッセージを確認して再度指示
```

### トラブル3: 生成されたコードにエラーがある

**症状：**
- TypeScriptエラー
- インポートエラー
- 実行時エラー

**解決法：**
```
エラー全文をコピーしてチャットに貼り付け：

「以下のエラーが発生しています：
[エラーメッセージ]

@問題のファイル
このエラーを修正してください。」
```


## 6.3 Cursor Rulesを活用する

配置したルールがそのディレクトリ以下のファイルに適用されます。

### Cursor Rulesの例 (プロジェクト固有のルール)

```md
---
alwaysApply: true
description: DRY原則に基づくコード品質向上のためのルール
---

# DRY原則（Don't Repeat Yourself）ガイドライン

## 基本原則
- **重複を避ける**: 同じロジック、データ、設定を複数箇所に書かない
- **単一責任**: 各関数、コンポーネント、モジュールは一つの責任を持つ
- **再利用性**: 共通の機能は抽象化して再利用可能にする

## 型定義の重複回避
- 型定義は [types/kanban.ts](mdc:kanban-board-app/src/types/kanban.ts) に集約
- インターフェースや型エイリアスは一度定義したら再利用
- 新しい型が必要な場合は、既存の型を拡張または組み合わせる

## 状態管理の一元化
- アプリケーション状態は [store/kanbanStore.ts](mdc:kanban-board-app/src/store/kanbanStore.ts) で管理
- コンポーネント間での状態共有はZustandストアを使用
- ローカル状態は最小限に抑える

## ユーティリティ関数の共通化
- 共通のロジックは [lib/utils.ts](mdc:kanban-board-app/src/lib/utils.ts) に配置
- 日付処理、文字列操作、バリデーションなどは再利用可能な関数として作成
- 同じ処理を複数箇所で行う場合は、必ず共通関数を作成

## コンポーネント設計
- UIコンポーネントは [components/ui/](mdc:kanban-board-app/src/components/ui/) に集約
- 似たようなUI要素は共通コンポーネントとして抽象化
- propsの型定義は再利用可能な形で設計

## 定数とマジックナンバーの管理
- ハードコードされた値は定数として定義
- 設定値は環境変数または設定ファイルで管理
- 色、サイズ、間隔などのデザイン値はTailwindの設定で統一

## コード重複の検出と修正
- 3回以上同じコードが出現する場合は必ず共通化を検討
- 似たような処理は抽象化レベルを上げて汎用化
- 条件分岐の重複は戦略パターンやファクトリーパターンで解決

## ファイル構造の統一
- 同じ種類のファイルは同じディレクトリに配置
- インポートパスは相対パスではなく絶対パスを使用
- ファイル名は機能を表す明確な名前にする
```

### Cursor Rulesの例 (テストファイルのルール)

```md
---
alwaysApply: true
description: カバレッジを意識したテスト戦略とベストプラクティス
---

# テストカバレッジ戦略

## テストの種類とカバレッジ目標
- **単体テスト**: 関数・コンポーネントレベルで90%以上のカバレッジ
- **統合テスト**: ユーザーフロー全体で80%以上のカバレッジ
- **E2Eテスト**: 主要な機能で100%のカバレッジ

## テストファイルの配置
src/ディレクトリ内にテストファイルを配置:
- components/TaskCard.tsx → components/TaskCard.test.tsx
- store/kanbanStore.ts → store/kanbanStore.test.ts  
- lib/utils.ts → lib/utils.test.ts
- 各コンポーネントに対応する.test.tsxファイルを作成

## 必須テスト対象
- [store/kanbanStore.ts](mdc:kanban-board-app/src/store/kanbanStore.ts) - 状態管理ロジック
- [lib/utils.ts](mdc:kanban-board-app/src/lib/utils.ts) - ユーティリティ関数
- [types/kanban.ts](mdc:kanban-board-app/src/types/kanban.ts) - 型定義のバリデーション
- 全Reactコンポーネント - レンダリングとユーザーインタラクション

## カバレッジ測定の設定
package.jsonに以下のスクリプトを追加:
- "test": "vitest"
- "test:coverage": "vitest --coverage" 
- "test:ui": "vitest --ui"

## テストの優先順位
1. **Critical Path**: タスクの作成、更新、削除、移動
2. **Business Logic**: フィルタリング、検索、WIP制限
3. **Edge Cases**: 空の状態、エラーハンドリング
4. **UI Interactions**: クリック、ドラッグ&ドロップ、フォーム入力

## カバレッジレポートの活用
- 未テストのコードを特定し、優先度を付けてテストを追加
- ブランチカバレッジを重視（if文、switch文の全分岐をテスト）
- 関数カバレッジで未実行の関数を特定
- 行カバレッジでデッドコードを発見

## テスト品質の指標
- **テストの独立性**: 各テストは他のテストに依存しない
- **テストの再現性**: 同じ結果が常に得られる
- **テストの明確性**: テストの意図が明確に分かる
- **テストの保守性**: コード変更時にテストも適切に更新される 
```

## 6.4 チーム開発での活用

### チーム用設定の共有

#### プロジェクトレベルの設定
最近のCursorでは、Settings → Cursor RulesでプロジェクトごとのAIの振る舞いを制御することが推奨されています。
詳細は[公式ドキュメント](https://docs.cursor.com/ja/context/rules)を参照してください。

#### コードレビューのワークフロー
```
1. 開発者A: 機能実装
2. 開発者A: AIレビューを実施
   「@変更ファイル セキュリティとパフォーマンスの観点でレビュー」
3. 開発者A: AIの指摘を修正
4. 開発者B: 人間によるレビュー
5. マージ
```

### ペアプログラミングwith Cursor

```
開発者1: 「この機能の実装方法を相談したい」
↓
Agent (Askモード): 実装案を提示
↓
開発者2: 「この方法でセキュリティ的に問題ないか？」
↓
チャット: セキュリティレビューを実施
↓
両者で実装を進める
```

## 6.5 生産性を最大化するTips

### ショートカットの活用

```
頻繁に使うショートカット：

1. Cmd+K → 選択部分を即座に改善
2. Cmd+L → 疑問をすぐに質問
3. Cmd+I → 複雑な実装を自動処理
4. Tab → 次の行を予測させる

カスタムショートカットの設定：
Preferences → Keyboard Shortcuts
```

### コンテキストウィンドウの管理

```
効率的なコンテキスト管理：

1. 関連ファイルだけを開く
2. @記法で必要なファイルだけ参照
3. 不要なタブは閉じる
4. .cursorignoreで大きなファイルを除外
```

.cursorignoreは.gitignoreと同じように使えます。  
詳しくは[公式ドキュメント](https://docs.cursor.com/ja/context/ignore-files#cursorignore)を参照してください。

### バッチ処理の活用

```
複数のタスクを一度に依頼：

Agent (Agentモード):
「以下をすべて実行してください：
1. 全コンポーネントにローディング状態を追加
2. エラーハンドリングを実装
3. TypeScriptのany型をすべて修正
4. 未使用のインポートを削除
5. テストファイルを生成」
```

## 📝 この章でAIペアプログラミングを通じて学んだこと

- ✅ AIへの効果的なプロンプトの書き方
- ✅ AIと協働する際のトラブルシューティング
- ✅ Cursor RulesでAIの動作を最適化
- ✅ チーム開発でAIを活用する方法
- ✅ AIペアプログラミングで生産性を向上させるTips

## 🎉 Cursorマスター認定

### AIペアプログラミングであなたができるようになったこと：

1. **AIとの対話スキル**
   - Tab補完、Cmd+K、Cmd+L、Cmd+I でAIと効果的に対話

2. **AIとの共同開発**
   - AIと協働して6-10倍の開発速度を体験

3. **AIレビューの活用**
   - AIにコード品質をチェックしてもらう

4. **AIとの問題解決**
   - AIと協働してエラーやトラブルを解決

5. **AIを活用したチーム開発**
   - AIペアプログラミングでチーム効率を向上

## 6.6 【補足】MCPサーバーで開発効率を向上（上級者向け）

### MCP (Model Context Protocol) とは

MCPサーバーは、Cursorに外部ツールやサービスを統合できる仕組みです。
これにより、様々な開発ツールをCursorから直接操作でき、開発効率が大幅に向上します。

### 利用可能なMCPサーバー例

- **Notion**: ドキュメント管理と連携
- **GitHub**: リポジトリ操作、Issue管理
- **Figma**: デザインデータの参照
- **Linear**: タスク管理
- **Playwright**: ブラウザ自動操作
- **Postgres/SQLite**: データベース操作
- **Context7**: 最新ドキュメントの参照

- その他多数

### MCPサーバーの追加方法

**簡単なGUI操作で追加：**

1. Cursorの設定を開く（Cmd+, / Ctrl+,）
2. 「MCP」セクションを選択
3. 「Add MCP Server」をクリック
4. [公式MCPディレクトリ](https://docs.cursor.com/en/tools/mcp#mcp-servers)から必要なツールを選択
5. 「Add to Cursor」ボタンをクリック
6. 必要な認証情報を入力

### 実践例: GitHubとの連携

```
MCPサーバー追加後の使用例：

チャット: 「GitHubのIssue #123の内容を確認して」
→ MCPが自動的にGitHub APIにアクセスして情報取得

Agent: 「このPRのレビューコメントを反映して修正」
→ GitHub上のコメントを読み取り、コードを自動修正
```

### 実績例: Playwrightを使った動作確認

```

@kanban-board-app/ 
このアプリを起動してから
Playwrightでタスクを作ってカードを動かしてみて
```

### MCPサーバー活用のメリット

1. **コンテキストの拡張**: 外部サービスのデータを直接参照
2. **自動化の強化**: 複数ツールを横断した作業の自動化
3. **ワークフロー統合**: 開発フロー全体をCursor内で完結

### 注意事項

- MCPサーバーは追加の設定が必要
- 一部のサーバーは有料サービスとの連携が必要
- 初心者はまず基本機能をマスターしてから導入推奨

**💡 Tips**: まずはGitHubやNotionなど、普段使っているツールから試してみましょう。

## 🚀 さらなる学習へ

### 次のステップ

1. **より複雑なプロジェクトに挑戦**
   - フルスタックアプリケーション
   - マイクロサービス
   - モバイルアプリ

2. **MCPサーバーの活用**
   - 開発ツールの統合
   - カスタムMCPサーバーの作成

3. **カスタムエージェントの作成**
   - プロジェクト固有の自動化

4. **コミュニティへの参加**
   - Cursor Discord
   - GitHub Discussions

## 🏆 完了おめでとうございます！

これで、CursorでAIペアプログラミングを学ぶ全カリキュラムが完了しました。
あなたは今、AIと効果的に協働できるプログラマーです！

---

### 最終チェックリスト

- [ ] 効果的なプロンプトが書ける
- [ ] トラブルを自力で解決できる
- [ ] Cursor Rulesを最適化できる
- [ ] チーム開発で活用できる
- [ ] 6-10倍の開発速度を実現できる

**Congratulations on becoming a Cursor Master! 🎊**